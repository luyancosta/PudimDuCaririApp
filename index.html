<!DOCTYPE html>

<html lang="pt-BR">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Pudim Du Cariri - Gest√£o Online</title>

    

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>



    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>



    <style>

        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');



        :root {

            --bg-color: #FEF3C7; --primary: #D97706; --primary-hover: #B45309; 

            --secondary: #78350F; --text-main: #451A03; --card-bg: #FFFFFF;

            --success: #10B981; --danger: #EF4444; --info: #3B82F6; --border: #FCD34D;

        }



        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }

        body { background-color: var(--bg-color); color: var(--text-main); }



        /* TELA DE LOGIN */

        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-color); display: flex; align-items: center; justify-content: center; z-index: 9999; flex-direction: column;}

        .login-box { background: var(--card-bg); padding: 2.5rem; border-radius: 10px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; max-width: 400px; width: 90%; border-top: 5px solid var(--primary);}

        .login-box h1 { color: var(--secondary); margin-bottom: 1.5rem; }

        .login-box input { margin-bottom: 1rem; width: 100%; padding: 0.8rem; border: 1px solid var(--border); border-radius: 5px; outline: none;}

        .login-box button { width: 100%; background: var(--primary); color: white; padding: 0.8rem; border: none; border-radius: 5px; font-weight: 600; cursor: pointer; font-size: 1rem; transition: 0.3s;}

        .login-box button:hover { background: var(--primary-hover); }



        /* TOAST NOTIFICATION (Pop-up visual) */

        .toast {

            visibility: hidden; min-width: 250px; background-color: var(--success); color: #fff;

            text-align: center; border-radius: 8px; padding: 16px; position: fixed;

            z-index: 10000; bottom: 30px; right: 30px; font-size: 1rem; font-weight: 600;

            box-shadow: 0px 4px 10px rgba(0,0,0,0.2); opacity: 0; transition: opacity 0.3s, transform 0.3s;

            transform: translateY(20px);

        }

        .toast.show { visibility: visible; opacity: 1; transform: translateY(0); }

        .toast.error { background-color: var(--danger); }



        /* O APP PRINCIPAL FICA ESCONDIDO AT√â LOGAR */

        #app-container { display: none; }



        /* HEADER E TABS */

        header { background-color: var(--secondary); color: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); flex-wrap: wrap; gap: 10px;}

        header h1 { font-size: 1.5rem; font-weight: 700; color: #FDE68A; margin: 0;}

        .header-actions { display: flex; align-items: center; gap: 10px; flex-wrap: wrap;}

        .header-actions button { background-color: var(--primary); color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; font-weight: 600; transition: 0.2s;}

        .header-actions button:hover { background: var(--primary-hover); }



        .tabs { display: flex; overflow-x: auto; background: var(--card-bg); padding: 0 1rem; border-bottom: 3px solid var(--border); }

        .tab-btn { background: none; border: none; padding: 1rem 1.2rem; font-size: 0.95rem; font-weight: 600; color: var(--secondary); cursor: pointer; border-bottom: 3px solid transparent; margin-bottom: -3px; transition: 0.3s; white-space: nowrap; }

        .tab-btn:hover { color: var(--primary); }

        .tab-btn.active { border-bottom-color: var(--primary); color: var(--primary); }



        .content { padding: 2rem; max-width: 1400px; margin: 0 auto; display: none; }

        .content.active { display: block; }



        /* CARDS & DASHBOARD */

        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(230px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }

        .card { background: var(--card-bg); padding: 1.5rem; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-left: 5px solid var(--primary); display: flex; flex-direction: column; justify-content: space-between;}

        .card h3 { font-size: 0.85rem; color: var(--secondary); margin-bottom: 0.5rem; text-transform: uppercase; }

        .card p { font-size: 1.6rem; font-weight: 700; color: var(--text-main); }

        .btn-action-small { margin-top: 10px; font-size: 0.85rem; padding: 6px 12px; background: var(--primary); color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600; transition: 0.2s; width: 100%;}

        

        .estoque-card { position: relative; text-align: center; }

        .estoque-card h3 { font-size: 0.75rem; height: 35px; }

        .estoque-card p { font-size: 1.8rem; transition: 0.3s; }

        .estoque-card p.status-green { color: var(--success) !important; }

        .estoque-card p.status-yellow { color: #F59E0B !important; }

        .estoque-card p.status-red { color: var(--danger) !important; }

        .estoque-card p.status-blink { animation: piscarTextRed 1.2s infinite; }

        .btn-edit-stock { position: absolute; top: 10px; right: 10px; background: none; border: none; cursor: pointer; font-size: 1.2rem; opacity: 0.4; transition: 0.2s;}



        @keyframes piscarFundoRed { 0%, 100% { background-color: transparent; color: #EF4444; } 50% { background-color: #EF4444; color: white; border-radius: 5px; padding: 0 5px; } }

        @keyframes piscarTextRed { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }

        .alerta-negativo { animation: piscarFundoRed 1s infinite !important; display: inline-block; }



        /* FORMS & TABLES */

        .form-group { margin-bottom: 1rem; }

        label { display: block; font-weight: 600; margin-bottom: 0.3rem; font-size: 0.9rem; }

        input, select { width: 100%; padding: 0.6rem; border: 1px solid var(--border); border-radius: 5px; outline: none; transition: 0.3s; }

        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }

        .btn-submit { background: var(--primary); color: white; padding: 0.8rem 1.5rem; border: none; border-radius: 5px; cursor: pointer; font-weight: 600; font-size: 1rem; margin-top: 1rem; width: 100%; transition: 0.3s;}

        

        .table-container { overflow-x: auto; background: var(--card-bg); padding: 1rem; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }

        table { width: 100%; border-collapse: collapse; min-width: 900px; }

        th, td { padding: 0.8rem 1rem; text-align: left; border-bottom: 1px solid #FEF3C7; font-size: 0.9rem; }

        th { background: var(--secondary); color: white; font-weight: 600; position: sticky; top: 0; }

        tr:hover { background-color: #FFFBEB; }

        .btn-delete { background: var(--danger); color: white; border: none; padding: 0.4rem 0.6rem; border-radius: 3px; cursor: pointer; font-size: 0.8rem; }

        .btn-edit { background: var(--info); color: white; border: none; padding: 0.4rem 0.6rem; border-radius: 3px; cursor: pointer; font-size: 0.8rem; margin-right: 5px; }

        .btn-excel { background: #10B981; color: white; border: none; padding: 0.6rem 1.2rem; border-radius: 5px; cursor: pointer; font-weight: 600; margin-bottom: 10px; float: right;}



        .section-title { margin-bottom: 1rem; color: var(--secondary); border-bottom: 2px solid var(--border); padding-bottom: 0.5rem; }

        .mt-2 { margin-top: 2rem; }

        .global-title { background: var(--secondary); color: #FDE68A; padding: 0.5rem 1rem; border-radius: 5px; margin-top: 3rem; margin-bottom: 1rem; text-align: center; font-size: 1.2rem;}



        /* MODO VISUALIZADOR */

        body.viewer-mode .btn-submit,

        body.viewer-mode .btn-delete,

        body.viewer-mode .btn-edit,

        body.viewer-mode .btn-edit-stock,

        body.viewer-mode .btn-action-small,

        body.viewer-mode .header-actions button:not(#btn-logout) { 

            display: none !important; 

        }

        body.viewer-mode input, 

        body.viewer-mode select { 

            pointer-events: none !important; 

            background: #f3f4f6 !important; 

            color: #999;

        }

    </style>

</head>

<body>



    <div id="toast" class="toast">A√ß√£o salva com sucesso!</div>



    <div id="login-screen">

        <div class="login-box">

            <h1>üçÆ Pudim Du Cariri</h1>

            <p style="margin-bottom: 1.5rem; color: #666; font-size: 0.9rem;">Acesso Restrito ao Sistema</p>

            <input type="email" id="login-email" placeholder="E-mail" autocomplete="off">

            <input type="password" id="login-password" placeholder="Senha">

            <button onclick="fazerLogin()">Entrar no Sistema</button>

            <p id="login-error" style="color: var(--danger); font-size: 0.8rem; margin-top: 10px; display: none;">Email ou senha incorretos!</p>

        </div>

    </div>



    <div id="app-container">

        <header>

            <h1>üçÆ Pudim Du Cariri</h1>

            <div class="header-actions">

                <span id="user-badge" style="font-size: 0.8rem; color: #FDE68A; font-weight: bold;"></span>

                <button onclick="exportDataBlob()">üì• Backup Data</button>

                <button onclick="document.getElementById('importFile').click()">üì§ Restaurar</button>

                <input type="file" id="importFile" style="display:none" accept=".json" onchange="importData(event)">

                <button id="btn-logout" style="background: var(--danger)" onclick="fazerLogout()">Sair</button>

            </div>

        </header>



        <div class="tabs">

            <button class="tab-btn active" onclick="switchTab('dashboard-varejo')">Resumo Varejo</button>

            <button class="tab-btn" onclick="switchTab('dashboard-atacado')">Resumo Atacado</button>

            <button class="tab-btn" onclick="switchTab('estoque')">üì¶ Estoque</button>

            <button class="tab-btn" onclick="switchTab('vendas')">Vendas (Varejo)</button>

            <button class="tab-btn" onclick="switchTab('atacado')">Vendas (Atacado)</button>

            <button class="tab-btn" onclick="switchTab('rateio')">Rateio Financeiro</button>

            <button class="tab-btn" onclick="switchTab('despesas')">Despesas</button>

            <button class="tab-btn" onclick="switchTab('extrato')">Extrato Geral</button>

            <button class="tab-btn" onclick="switchTab('investimentos')">Investimentos</button>

            <button class="tab-btn" onclick="switchTab('config')">‚öôÔ∏è Config</button>

        </div>



        <div id="dashboard-varejo" class="content active">

            <h2 class="section-title">üìä Resumo de Desempenho - VAREJO</h2>

            <div class="dashboard-grid">

                <div class="card"><h3>Faturamento Bruto</h3><p id="v-dash-bruto">R$ 0,00</p></div>

                <div class="card"><h3>Faturamento L√≠quido</h3><p id="v-dash-liquido">R$ 0,00</p></div>

                <div class="card"><h3>Receita de Entrega</h3><p id="v-dash-entrega">R$ 0,00</p></div>

                <div class="card"><h3>Pudins Vendidos</h3><p id="v-dash-qtd">0</p></div>

                

                <div class="card" style="border-left-color: #EF4444;"><h3>Insumo Fixo Gerado</h3><p id="v-dash-insumos" style="color: #EF4444;">R$ 0,00</p></div>

                <div class="card" style="border-left-color: #EF4444;"><h3>Custos Gerais (15%)</h3><p id="v-dash-cg" style="color: #EF4444;">R$ 0,00</p></div>

                <div class="card" style="border-left-color: #EF4444;"><h3>M√£o de Obra (20%)</h3><p id="v-dash-mo" style="color: #EF4444;">R$ 0,00</p></div>

                <div class="card" style="border-left-color: #10B981;"><h3>Lucro Restante</h3><p id="v-dash-lucro-restante" style="color: #10B981;">R$ 0,00</p></div>

                

                <div class="card" style="border-left-color: #8B5CF6;"><h3>Giro Gerado (50%)</h3><p id="v-dash-giro">R$ 0,00</p></div>

                <div class="card" style="border-left-color: #8B5CF6;"><h3>Fundo Gerado (15%)</h3><p id="v-dash-fundo">R$ 0,00</p></div>

                <div class="card" style="border-left-color: #F59E0B;"><h3>Luyan Gerado (17.5%)</h3><p id="v-dash-luyan">R$ 0,00</p></div>

                <div class="card" style="border-left-color: #F59E0B;"><h3>Beatriz Gerado (17.5%)</h3><p id="v-dash-beatriz">R$ 0,00</p></div>

            </div>

            <div class="global-title">üîí SALDOS GLOBAIS EM CAIXA (Varejo + Atacado - Despesas - Saques)</div>

            <div id="grid-saldos-varejo"></div>

        </div>



        <div id="dashboard-atacado" class="content">

            <h2 class="section-title">üì¶ Resumo de Desempenho - ATACADO (Apenas PAGOS)</h2>

            <div class="dashboard-grid">

                <div class="card"><h3>Faturamento Bruto</h3><p id="a-dash-bruto">R$ 0,00</p></div>

                <div class="card"><h3>Desc. Log√≠stica Reversa</h3><p id="a-dash-desconto" style="color: var(--danger)">R$ 0,00</p></div>

                <div class="card"><h3>Faturamento L√≠quido</h3><p id="a-dash-liquido">R$ 0,00</p></div>

                <div class="card"><h3>Pudins Vendidos</h3><p id="a-dash-qtd">0</p></div>

                

                <div class="card" style="border-left-color: #EF4444;"><h3>Insumo Fixo Gerado</h3><p id="a-dash-insumos" style="color: #EF4444;">R$ 0,00</p></div>

                <div class="card" style="border-left-color: #EF4444;"><h3>Custos Gerais (15%)</h3><p id="a-dash-cg" style="color: #EF4444;">R$ 0,00</p></div>

                <div class="card" style="border-left-color: #EF4444;"><h3>M√£o de Obra (20%)</h3><p id="a-dash-mo" style="color: #EF4444;">R$ 0,00</p></div>

                <div class="card" style="border-left-color: #10B981;"><h3>Lucro Restante</h3><p id="a-dash-lucro-restante" style="color: #10B981;">R$ 0,00</p></div>

                

                <div class="card" style="border-left-color: #8B5CF6;"><h3>Giro Gerado (50%)</h3><p id="a-dash-giro">R$ 0,00</p></div>

                <div class="card" style="border-left-color: #8B5CF6;"><h3>Fundo Gerado (15%)</h3><p id="a-dash-fundo">R$ 0,00</p></div>

                <div class="card" style="border-left-color: #F59E0B;"><h3>Luyan Gerado (17.5%)</h3><p id="a-dash-luyan">R$ 0,00</p></div>

                <div class="card" style="border-left-color: #F59E0B;"><h3>Beatriz Gerado (17.5%)</h3><p id="a-dash-beatriz">R$ 0,00</p></div>

            </div>

            <div class="global-title">üîí SALDOS GLOBAIS EM CAIXA (Varejo + Atacado - Despesas - Saques)</div>

            <div id="grid-saldos-atacado"></div>

        </div>



        <div id="estoque" class="content">

            <h2 class="section-title">üì¶ Posi√ß√£o Atual do Estoque</h2>

            <div class="dashboard-grid" style="grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));">

                <div class="card estoque-card" style="border-left-color: #10B981; background: #ECFDF5;">

                    <button class="btn-edit-stock" onclick="ajustarEstoqueRapido('pudim', 'Pudins Prontos (Copo Cheio)')">‚úèÔ∏è</button>

                    <h3>üçÆ PUDINS PRONTOS<br><small>(Copos Cheios)</small></h3><p id="est-pudim" class="status-green">0 un</p>

                </div>

                <div class="card estoque-card">

                    <button class="btn-edit-stock" onclick="ajustarEstoqueRapido('leite_condensado', 'Leite Condensado')">‚úèÔ∏è</button>

                    <h3>Leite Condensado</h3><p id="est-leite_condensado" class="status-green">0 un</p>

                </div>

                <div class="card estoque-card">

                    <button class="btn-edit-stock" onclick="ajustarEstoqueRapido('leite_integral', 'Leite Integral (ml)')">‚úèÔ∏è</button>

                    <h3>Leite Integral</h3><p id="est-leite_integral" class="status-green">0 ml</p>

                </div>

                <div class="card estoque-card">

                    <button class="btn-edit-stock" onclick="ajustarEstoqueRapido('ovos', 'Ovos')">‚úèÔ∏è</button>

                    <h3>Ovos</h3><p id="est-ovos" class="status-green">0 un</p>

                </div>

                <div class="card estoque-card">

                    <button class="btn-edit-stock" onclick="ajustarEstoqueRapido('acucar', 'A√ß√∫car (g)')">‚úèÔ∏è</button>

                    <h3>A√ß√∫car</h3><p id="est-acucar" class="status-green">0 g</p>

                </div>

                

                <div class="card estoque-card" style="border-left-color: #8B5CF6;">

                    <button class="btn-edit-stock" onclick="ajustarEstoqueRapido('copo', 'Copo Americano (Vazio)')">‚úèÔ∏è</button>

                    <h3>Copo Americano<br><small>(Vazios)</small></h3><p id="est-copo" class="status-green">0 un</p>

                </div>

                <div class="card estoque-card" style="border-left-color: #8B5CF6;">

                    <button class="btn-edit-stock" onclick="ajustarEstoqueRapido('tampa', 'Tampas')">‚úèÔ∏è</button>

                    <h3>Tampas</h3><p id="est-tampa" class="status-green">0 un</p>

                </div>

                <div class="card estoque-card" style="border-left-color: #8B5CF6;">

                    <button class="btn-edit-stock" onclick="ajustarEstoqueRapido('sacola', 'Sacolas')">‚úèÔ∏è</button>

                    <h3>Sacolas</h3><p id="est-sacola" class="status-green">0 un</p>

                </div>

                <div class="card estoque-card" style="border-left-color: #8B5CF6;">

                    <button class="btn-edit-stock" onclick="ajustarEstoqueRapido('adesivo', 'Adesivos')">‚úèÔ∏è</button>

                    <h3>Adesivos</h3><p id="est-adesivo" class="status-green">0 un</p>

                </div>

                <div class="card estoque-card" style="border-left-color: #8B5CF6;">

                    <button class="btn-edit-stock" onclick="ajustarEstoqueRapido('colher', 'Colheres')">‚úèÔ∏è</button>

                    <h3>Colheres</h3><p id="est-colher" class="status-green">0 un</p>

                </div>

            </div>



            <div style="display: flex; gap: 2rem; flex-wrap: wrap;">

                <div style="flex: 1; min-width: 300px;">

                    <h2 class="section-title">üë©‚Äçüç≥ Bater Receita (Produzir)</h2>

                    <div class="card">

                        <p style="font-size:0.8rem; color:#666; margin-bottom: 10px;"><b>1 Receita gera:</b> +6 Pudins Prontos.<br><b>Consome Insumos:</b> 1 L. Condensado, 400ml Leite, 3 Ovos, 200g A√ß√∫car.<br><b>Consome Embalagem:</b> 6 Copos Vazios, 6 Tampas, 6 Adesivos.</p>

                        <div class="form-grid">

                            <div class="form-group"><label>Data</label><input type="date" id="prod-data"></div>

                            <div class="form-group"><label>Qtd. de Receitas Feitas</label><input type="number" id="prod-qtd" min="1" value="1"></div>

                        </div>

                        <button class="btn-submit" style="background:#10B981" id="btn-submit-producao" onclick="addProducao()">Registrar Produ√ß√£o</button>

                    </div>

                </div>



                <div style="flex: 1; min-width: 300px;">

                    <h2 class="section-title">üì• Ajuste Manual Detalhado</h2>

                    <div class="card">

                        <div class="form-grid">

                            <div class="form-group"><label>Data</label><input type="date" id="mov-data"></div>

                            <div class="form-group"><label>Tipo</label><select id="mov-tipo"><option value="entrada">Entrada (+)</option><option value="saida">Sa√≠da (-)</option></select></div>

                            <div class="form-group">

                                <label>Item</label>

                                <select id="mov-item">

                                    <option value="leite_condensado">Leite Condensado (unidade)</option>

                                    <option value="leite_integral">Leite Integral (ml)</option>

                                    <option value="ovos">Ovos (unidade)</option>

                                    <option value="acucar">A√ß√∫car (g)</option>

                                    <option value="copo">Copo Vazio (unidade)</option>

                                    <option value="tampa">Tampas (unidade)</option>

                                    <option value="sacola">Sacolas (unidade)</option>

                                    <option value="adesivo">Adesivos (unidade)</option>

                                    <option value="colher">Colheres (unidade)</option>

                                    <option value="pudim">Pudins Prontos / Copo Cheio (unidade)</option>

                                </select>

                            </div>

                            <div class="form-group"><label>Qtd</label><input type="number" id="mov-qtd" min="1"></div>

                            <div class="form-group"><label>Motivo</label><input type="text" id="mov-desc"></div>

                        </div>

                        <button class="btn-submit" id="btn-submit-mov" onclick="addEstoqueMov()">Lan√ßar Ajuste</button>

                    </div>

                </div>

            </div>

            

            <div style="display:flex; gap:10px; margin-top: 2rem;">

                <div style="flex:1" class="table-container">

                    <h3 class="section-title">Hist√≥rico de Receitas</h3>

                    <table><thead><tr><th>N¬∫</th><th>Data</th><th>Receitas</th><th>A√ß√£o</th></tr></thead><tbody id="tbody-producoes"></tbody></table>

                </div>

                <div style="flex:2" class="table-container">

                    <h3 class="section-title">Hist√≥rico de Ajustes</h3>

                    <table><thead><tr><th>Data</th><th>Item</th><th>Qtd</th><th>Desc</th><th>A√ß√£o</th></tr></thead><tbody id="tbody-estoquemov"></tbody></table>

                </div>

            </div>

        </div>



        <div id="config" class="content">

            <h2 class="section-title">Par√¢metros e Taxas</h2>

            <div class="card">

                <div class="form-grid">

                    <div class="form-group"><label>Pre√ßo 1 Und (R$)</label><input type="number" id="cfg-preco-und" step="0.01"></div>

                    <div class="form-group"><label>Pre√ßo Combo 3 Und (R$)</label><input type="number" id="cfg-preco-combo" step="0.01"></div>

                    <div class="form-group"><label>Custo Fixo Insumo 1 Und (R$)</label><input type="number" id="cfg-custo-insumo" step="0.01"></div>

                    <div class="form-group"><label>Custo do Copo p/ Abater (R$)</label><input type="number" id="cfg-custo-copo" step="0.01"></div>

                    <div class="form-group"><label>Taxa Cr√©dito (Inser√ß√£o) %</label><input type="number" id="cfg-taxa-cred-ins" step="0.01"></div>

                    <div class="form-group"><label>Taxa Cr√©dito (Aproxima√ß√£o) %</label><input type="number" id="cfg-taxa-cred-apr" step="0.01"></div>

                    <div class="form-group"><label>Taxa D√©bito (Inser√ß√£o) %</label><input type="number" id="cfg-taxa-deb-ins" step="0.01"></div>

                    <div class="form-group"><label>Taxa D√©bito (Aproxima√ß√£o) %</label><input type="number" id="cfg-taxa-deb-apr" step="0.01"></div>

                    <div class="form-group"><label>Taxa Cart√£o Online (%)</label><input type="number" id="cfg-taxa-cartao-online" step="0.01" placeholder="Ex: 2.99"></div>

                </div>

                <button class="btn-submit" onclick="saveConfig()">Salvar Configura√ß√µes</button>

            </div>

        </div>



        <div id="vendas" class="content">

            <h2 class="section-title">Registrar Venda (Varejo)</h2>

            <div class="card">

                <div class="form-grid">

                    <div class="form-group"><label>Data</label><input type="date" id="v-data"></div>

                    <div class="form-group">

                        <label>Produto</label>

                        <select id="v-produto">

                            <option value="Unidade">Pudim 1 Und</option>

                            <option value="Combo">Combo (3 und)</option>

                        </select>

                    </div>

                    <div class="form-group"><label>Quantidade</label><input type="number" id="v-qtd" value="1" min="1"></div>

                    <div class="form-group"><label>Desconto (R$)</label><input type="number" id="v-desconto" step="0.01" value="0" placeholder="0.00"></div>

                    

                    <div class="form-group">

                        <label>Forma de Pagamento</label>

                        <select id="v-pgto" onchange="toggleAsaas()">

                            <option value="PIX">PIX</option>

                            <option value="Dinheiro">Dinheiro</option>

                            <option value="Credito Insercao">Cr√©dito (Inser√ß√£o)</option>

                            <option value="Credito Aproximacao">Cr√©dito (Aproxima√ß√£o)</option>

                            <option value="Debito Insercao">D√©bito (Inser√ß√£o)</option>

                            <option value="Debito Aproximacao">D√©bito (Aproxima√ß√£o)</option>

                            <option value="Cartao Online">Cart√£o Online (Mercado Pago)</option>

                        </select>

                    </div>

                    

                    <div class="form-group" id="asaas-group" style="display: flex; align-items: center; gap: 8px;">

                        <input type="checkbox" id="v-asaas" style="width: auto; margin: 0; padding: 0;">

                        <label for="v-asaas" style="margin: 0; font-size: 0.85rem; color: #D97706;">Cobrado via Asaas (Descontar R$ 0,14)</label>

                    </div>



                    <div class="form-group"><label>Taxa de Entrega (R$)</label><input type="number" id="v-entrega" step="0.01" value="0" placeholder="0.00"></div>

                </div>

                <button class="btn-submit" id="btn-submit-vendas" onclick="addVenda()">Adicionar Venda</button>

            </div>

            <h3 class="section-title mt-2">Hist√≥rico de Vendas (Varejo)</h3>

            <div class="table-container">

                <table>

                    <thead><tr><th>N¬∫</th><th>Data</th><th>Produto</th><th>Qtd</th><th>Desc.</th><th>Pgto</th><th>Bruto</th><th>Taxa</th><th>Entrega</th><th>L√≠quido</th><th>A√ß√£o</th></tr></thead>

                    <tbody id="tbody-vendas"></tbody>

                </table>

            </div>

        </div>



        <div id="atacado" class="content">

            <h2 class="section-title">Registrar Venda (Atacado)</h2>

            <div class="card">

                <div class="form-grid">

                    <div class="form-group"><label>Data</label><input type="date" id="a-data"></div>

                    <div class="form-group"><label>Cliente / Parceiro</label><input type="text" id="a-cliente" placeholder="Ex: Conde Burguers"></div>

                    <div class="form-group"><label>Qtd. de Pudins</label><input type="number" id="a-qtd"></div>

                    <div class="form-group"><label>Valor Unit. Negociado (R$)</label><input type="number" id="a-valor" step="0.01"></div>

                    

                    <div class="form-group"><label>Qtd. Copos Devolvidos</label><input type="number" id="a-copos" value="0" min="0" oninput="calcDescAtacado()"></div>

                    <div class="form-group"><label>Desconto Log√≠stica (R$)</label><input type="number" id="a-desconto" step="0.01" value="0"></div>

                    

                    <div class="form-group">

                        <label>Status</label>

                        <select id="a-status"><option value="PAGO">Pago</option><option value="N√ÉO PAGO">N√£o Pago</option></select>

                    </div>

                </div>

                <button class="btn-submit" id="btn-submit-atacado" onclick="addAtacado()">Adicionar Venda Atacado</button>

            </div>

            <div class="table-container mt-2">

                <table>

                    <thead><tr><th>N¬∫</th><th>Data</th><th>Cliente</th><th>Qtd</th><th>Unit√°rio</th><th>Bruto</th><th>Copos(R$)</th><th>L√≠quido</th><th>Status</th><th>A√ß√£o</th></tr></thead>

                    <tbody id="tbody-atacado"></tbody>

                </table>

            </div>

        </div>



        <div id="rateio" class="content">

            <div style="display:flex; justify-content:space-between; align-items:center;">

                <h2 class="section-title" style="margin:0; border:none;">Matem√°tica do Rateio - VAREJO</h2>

                <button class="btn-excel" onclick="exportarExcel()">üìä Exportar para Excel</button>

            </div>

            <div class="table-container">

                <table>

                    <thead><tr><th>Pedido</th><th>Data</th><th>Produto/Qtd</th><th>L√≠quido</th><th>Insumo(Fixo)</th><th>Gerais(15%)</th><th>M√£o(20%)</th><th>Restante</th><th>Giro(50%)</th><th>Fundo(15%)</th><th>Luyan</th><th>Beatriz</th></tr></thead>

                    <tbody id="tbody-rateio-varejo"></tbody>

                </table>

            </div>



            <h2 class="section-title mt-2">Matem√°tica do Rateio - ATACADO (Apenas Pagos)</h2>

            <div class="table-container">

                <table>

                    <thead><tr><th>Pedido</th><th>Data</th><th>Cliente/Qtd</th><th>L√≠quido(c/ Desc)</th><th>Insumo(Fixo)</th><th>Gerais(15%)</th><th>M√£o(20%)</th><th>Restante</th><th>Giro(50%)</th><th>Fundo(15%)</th><th>Luyan</th><th>Beatriz</th></tr></thead>

                    <tbody id="tbody-rateio-atacado"></tbody>

                </table>

            </div>

        </div>



        <div id="despesas" class="content">

            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 1rem;">

                <h2 class="section-title" style="margin:0; border:none;">Dashboard de Despesas (Financeiro)</h2>

                <button class="btn-excel" onclick="exportarExcel()">üìä Exportar Despesas (Excel)</button>

            </div>

            

            <div class="dashboard-grid" style="margin-bottom: 2rem;">

                <div class="card" style="border-left-color: #3B82F6;"><h3>Total Insumos</h3><p id="dash-desp-insumos">R$ 0,00</p></div>

                <div class="card" style="border-left-color: #F59E0B;"><h3>Total Embalagem</h3><p id="dash-desp-embalagem">R$ 0,00</p></div>

                <div class="card" style="border-left-color: #EF4444;"><h3>Total Gastos Gerais</h3><p id="dash-desp-gerais">R$ 0,00</p></div>

                <div class="card" style="border-left-color: #8B5CF6;"><h3>Total Marketing</h3><p id="dash-desp-marketing">R$ 0,00</p></div>

            </div>



            <h2 class="section-title">Registrar Despesas/Compras</h2>

            <div class="card">

                <div class="form-grid">

                    <div class="form-group"><label>Data</label><input type="date" id="d-data"></div>

                    <div class="form-group"><label>Item</label><input type="text" id="d-item" placeholder="Ex: Leite Condensado"></div>

                    <div class="form-group"><label>Quantidade</label><input type="number" id="d-qtd" step="0.01"></div>

                    <div class="form-group"><label>Valor Unit√°rio (R$)</label><input type="number" id="d-valor" step="0.01"></div>

                    <div class="form-group">

                        <label>Categoria</label>

                        <select id="d-categoria"><option value="INSUMOS">Insumos</option><option value="EMBALAGEM">Embalagem</option><option value="GASTOS GERAIS">Gastos Gerais</option><option value="MARKETING">Marketing</option></select>

                    </div>

                </div>

                <button class="btn-submit" id="btn-submit-despesas" onclick="addDespesa()">Adicionar Despesa</button>

            </div>

            <div class="table-container mt-2">

                <table>

                    <thead><tr><th>N¬∫</th><th>Data</th><th>Item</th><th>Qtd</th><th>Unit√°rio</th><th>Total</th><th>Categoria</th><th>A√ß√£o</th></tr></thead>

                    <tbody id="tbody-despesas"></tbody>

                </table>

            </div>

        </div>



        <div id="investimentos" class="content">

            <h2 class="section-title">Investimento Inicial / Equipamentos</h2>

            <div class="card">

                <div class="form-grid">

                    <div class="form-group"><label>Data</label><input type="date" id="i-data"></div>

                    <div class="form-group"><label>Item/Equipamento</label><input type="text" id="i-item" placeholder="Ex: M√°quina Vapor"></div>

                    <div class="form-group"><label>Valor Total (R$)</label><input type="number" id="i-valor" step="0.01"></div>

                </div>

                <button class="btn-submit" id="btn-submit-investimentos" onclick="addInvestimento()">Adicionar Investimento</button>

            </div>

            <div class="table-container mt-2">

                <table>

                    <thead><tr><th>Data</th><th>Item</th><th>Valor</th><th>A√ß√£o</th></tr></thead>

                    <tbody id="tbody-investimentos"></tbody>

                </table>

            </div>

        </div>



        <div id="extrato" class="content">

            <h2 class="section-title">Extrato Geral (Linha do Tempo dos Saques)</h2>

            

            <div class="card" style="margin-bottom: 2rem;">

                <div class="form-grid">

                    <div class="form-group"><label>Data do Saque</label><input type="date" id="p-data"></div>

                    <div class="form-group">

                        <label>Caixa a Retirar</label>

                        <select id="p-tipo">

                            <option value="Divida">Giro (Abater D√≠vida Inicial)</option>

                            <option value="MaoObra">M√£o de Obra</option>

                            <option value="Luyan">S√≥cios: Luyan</option>

                            <option value="Beatriz">S√≥cios: Beatriz</option>

                        </select>

                    </div>

                    <div class="form-group"><label>Valor a Sacar (R$)</label><input type="number" id="p-valor" step="0.01" placeholder="Ex: 50.00"></div>

                </div>

                <button class="btn-submit" id="btn-submit-pagamentos" onclick="addPagamento()">Registrar Retirada Manual</button>

            </div>



            <h3 class="section-title mt-2">Hist√≥rico de Movimenta√ß√µes</h3>

            <div class="table-container">

                <table>

                    <thead>

                        <tr><th>Data</th><th>Caixa / Descri√ß√£o</th><th>Saldo Anterior</th><th>Valor Sacado</th><th>Saldo Restante</th><th>A√ß√£o</th></tr>

                    </thead>

                    <tbody id="tbody-pagamentos"></tbody>

                </table>

            </div>

        </div>

    </div> <script>

        // =========================================================

        // 1. CONFIGURA√á√ÉO DO FIREBASE E PERMISS√ïES

        // =========================================================

        const firebaseConfig = {

            apiKey: "AIzaSyDctGxi1zGwJuHJ_eaFJn3TmErK9tWaGy0",

            authDomain: "pudimducaririapp.firebaseapp.com",

            databaseURL: "https://pudimducaririapp-default-rtdb.firebaseio.com",

            projectId: "pudimducaririapp",

            storageBucket: "pudimducaririapp.firebasestorage.app",

            messagingSenderId: "302932015479",

            appId: "1:302932015479:web:dd46d6c1c0b27ee6948972"

        };

        

        const ADMIN_EMAIL = "luyan@pudim.com"; 

        const VIEWER_EMAIL = "beatriz@pudim.com"; 



        let isOnline = firebaseConfig.apiKey && firebaseConfig.apiKey !== "COLE_SUA_API_KEY_AQUI";

        if(isOnline) { firebase.initializeApp(firebaseConfig); }



        // =========================================================

        // 2. DADOS INJETADOS DO BACKUP (C/ Numera√ß√£o)

        // =========================================================

        let db = {

            "config": { "precoUnd": 15, "precoCombo": 40, "custoInsumo": 5.95, "taxaCredIns": 4.98, "taxaCredApr": 3.09, "taxaDebIns": 1.99, "taxaDebApr": 0.89, "custoCopo": 1.5, "taxaCartaoOnline": 2.99 },

            "vendas": [

                {"num":1, "id": 300, "data": "2026-02-12", "produto": "Combo (3 und)", "pgto": "PIX", "valorBruto": 40, "valorTaxa": 0, "valorLiquido": 40, "entrega": 0},

                {"num":2, "id": 301, "data": "2026-02-12", "produto": "Combo (3 und)", "pgto": "PIX", "valorBruto": 40, "valorTaxa": 0, "valorLiquido": 40, "entrega": 0},

                {"num":3, "id": 302, "data": "2026-02-12", "produto": "Pudim 1 Und", "pgto": "Credito Insercao", "valorBruto": 15, "valorTaxa": 0.46, "valorLiquido": 14.54, "entrega": 0},

                {"num":4, "id": 303, "data": "2026-02-12", "produto": "Pudim 1 Und", "pgto": "PIX", "valorBruto": 15, "valorTaxa": 0, "valorLiquido": 15, "entrega": 0},

                {"num":5, "id": 304, "data": "2026-02-12", "produto": "Pudim 1 Und", "pgto": "PIX", "valorBruto": 15, "valorTaxa": 0, "valorLiquido": 15, "entrega": 0},

                {"num":6, "id": 305, "data": "2026-02-12", "produto": "Pudim 1 Und", "pgto": "PIX", "valorBruto": 15, "valorTaxa": 0, "valorLiquido": 15, "entrega": 0},

                {"num":7, "id": 306, "data": "2026-02-12", "produto": "Pudim 1 Und", "pgto": "PIX", "valorBruto": 15, "valorTaxa": 0, "valorLiquido": 15, "entrega": 0},

                {"num":8, "id": 307, "data": "2026-02-12", "produto": "Pudim 1 Und", "pgto": "PIX", "valorBruto": 15, "valorTaxa": 0, "valorLiquido": 15, "entrega": 0},

                {"num":9, "id": 308, "data": "2026-02-12", "produto": "Pudim 1 Und", "pgto": "PIX", "valorBruto": 15, "valorTaxa": 0, "valorLiquido": 15, "entrega": 0},

                {"num":10, "id": 309, "data": "2026-02-12", "produto": "Pudim 1 Und", "pgto": "Debito Insercao", "valorBruto": 15, "valorTaxa": 0.47, "valorLiquido": 14.53, "entrega": 0},

                {"num":11, "id": 310, "data": "2026-02-13", "produto": "Combo (3 und)", "pgto": "PIX", "valorBruto": 40, "valorTaxa": 0, "valorLiquido": 40, "entrega": 0},

                {"num":12, "id": 311, "data": "2026-02-13", "produto": "Combo (3 und)", "pgto": "PIX", "valorBruto": 40, "valorTaxa": 0, "valorLiquido": 40, "entrega": 0},

                {"num":13, "id": 312, "data": "2026-02-13", "produto": "Pudim 1 Und", "pgto": "PIX", "valorBruto": 15, "valorTaxa": 0, "valorLiquido": 15, "entrega": 0},

                {"num":14, "id": 313, "data": "2026-02-13", "produto": "Pudim 1 Und", "pgto": "PIX", "valorBruto": 15, "valorTaxa": 0, "valorLiquido": 15, "entrega": 0},

                {"num":15, "id": 314, "data": "2026-02-13", "produto": "Pudim 1 Und", "pgto": "PIX", "valorBruto": 15, "valorTaxa": 0, "valorLiquido": 15, "entrega": 0},

                {"num":16, "id": 315, "data": "2026-02-13", "produto": "Pudim 1 Und", "pgto": "PIX", "valorBruto": 15, "valorTaxa": 0, "valorLiquido": 15, "entrega": 0},

                {"num":17, "id": 316, "data": "2026-02-13", "produto": "Pudim 1 Und", "pgto": "PIX", "valorBruto": 15, "valorTaxa": 0, "valorLiquido": 15, "entrega": 0},

                {"num":18, "id": 317, "data": "2026-02-14", "produto": "Combo (3 und)", "pgto": "Dinheiro", "valorBruto": 40, "valorTaxa": 0, "valorLiquido": 40, "entrega": 0},

                {"num":19, "id": 318, "data": "2026-02-14", "produto": "Combo (3 und)", "pgto": "Dinheiro", "valorBruto": 40, "valorTaxa": 0, "valorLiquido": 40, "entrega": 0},

                {"num":20, "id": 319, "data": "2026-02-14", "produto": "Combo (3 und)", "pgto": "Credito Insercao", "valorBruto": 40, "valorTaxa": 1.24, "valorLiquido": 38.76, "entrega": 0},

                {"num":21, "id": 320, "data": "2026-02-14", "produto": "Combo (3 und)", "pgto": "Credito Insercao", "valorBruto": 40, "valorTaxa": 1.32, "valorLiquido": 38.68, "entrega": 0},

                {"num":22, "id": 321, "data": "2026-02-14", "produto": "Pudim 1 Und", "pgto": "PIX", "valorBruto": 15, "valorTaxa": 0, "valorLiquido": 15, "entrega": 0},

                {"num":23, "id": 322, "data": "2026-02-14", "produto": "Combo (3 und)", "pgto": "PIX", "valorBruto": 40, "valorTaxa": 0, "valorLiquido": 40, "entrega": 0},

                {"num":24, "id": 323, "data": "2026-02-14", "produto": "Combo (3 und)", "pgto": "PIX", "valorBruto": 40, "valorTaxa": 0, "valorLiquido": 40, "entrega": 0},

                {"num":25, "id": 324, "data": "2026-02-14", "produto": "Pudim 1 Und", "pgto": "PIX", "valorBruto": 15, "valorTaxa": 0, "valorLiquido": 15, "entrega": 0},

                {"num":26, "id": 325, "data": "2026-02-14", "produto": "Combo (3 und)", "pgto": "Debito Insercao", "valorBruto": 40, "valorTaxa": 0.36, "valorLiquido": 39.64, "entrega": 0},

                {"num":27, "id": 326, "data": "2026-02-14", "produto": "Combo (3 und)", "pgto": "Credito Insercao", "valorBruto": 40, "valorTaxa": 1.24, "valorLiquido": 38.76, "entrega": 0},

                {"num":28, "id": 327, "data": "2026-02-14", "produto": "Combo (3 und)", "pgto": "Dinheiro", "valorBruto": 40, "valorTaxa": 0, "valorLiquido": 40, "entrega": 0},

                {"num":29, "id": 328, "data": "2026-02-15", "produto": "Pudim 1 Und", "pgto": "PIX", "valorBruto": 15, "valorTaxa": 0, "valorLiquido": 15, "entrega": 0},

                {"num":30, "id": 329, "data": "2026-02-15", "produto": "Pudim 1 Und", "pgto": "PIX", "valorBruto": 15, "valorTaxa": 0, "valorLiquido": 15, "entrega": 0},

                {"num":31, "id": 330, "data": "2026-02-15", "produto": "Combo (3 und)", "pgto": "Credito Insercao", "valorBruto": 40, "valorTaxa": 1.24, "valorLiquido": 38.76, "entrega": 0},

                {"num":32, "id": 331, "data": "2026-02-15", "produto": "Combo (3 und)", "pgto": "Debito Insercao", "valorBruto": 40, "valorTaxa": 0.36, "valorLiquido": 39.64, "entrega": 0}

            ],

            "atacado": [

                {"num":1, "id": 200, "data": "2026-02-13", "cliente": "Davi (88 Smash)", "qtd": 12, "unitario": 10, "total": 120, "status": "N√ÉO PAGO", "coposDevolvidos": 0, "desconto": 0, "totalBruto": 120, "totalLiquido": 120},

                {"num":2, "id": 201, "data": "2026-02-14", "cliente": "Conde Burguers", "qtd": 24, "unitario": 10.99, "total": 263.76, "status": "PAGO", "coposDevolvidos": 0, "desconto": 0, "totalBruto": 263.76, "totalLiquido": 263.76},

                {"num":3, "id": 202, "data": "2026-02-15", "cliente": "Davi (88 Smash)", "qtd": 6, "unitario": 10, "total": 60, "status": "N√ÉO PAGO", "coposDevolvidos": 0, "desconto": 0, "totalBruto": 60, "totalLiquido": 60}

            ],

            "despesas": [

                {"num":1, "id": 108, "data": "2026-02-13", "item": "OVOS", "qtd": 1, "unitario": 5.51, "total": 5.51, "categoria": "INSUMOS"},

                {"num":2, "id": 110, "data": "2026-02-13", "item": "LEITE", "qtd": 2, "unitario": 4, "total": 8, "categoria": "INSUMOS"},

                {"num":3, "id": 111, "data": "2026-02-13", "item": "IMPULSIONAMENTO", "qtd": 1, "unitario": 30, "total": 30, "categoria": "MARKETING"},

                {"num":4, "id": 100, "data": "2026-02-14", "item": "A√áUCAR", "qtd": 2, "unitario": 3.79, "total": 7.58, "categoria": "INSUMOS"},

                {"num":5, "id": 102, "data": "2026-02-14", "item": "OVOS", "qtd": 1, "unitario": 11.99, "total": 11.99, "categoria": "INSUMOS"},

                {"num":6, "id": 103, "data": "2026-02-14", "item": "COPOS", "qtd": 72, "unitario": 1.2, "total": 86.4, "categoria": "EMBALAGEM"},

                {"num":7, "id": 104, "data": "2026-02-14", "item": "PAPEL ALUMINIO", "qtd": 1, "unitario": 4, "total": 4, "categoria": "INSUMOS"},

                {"num":8, "id": 105, "data": "2026-02-14", "item": "LUVAS", "qtd": 1, "unitario": 30, "total": 30, "categoria": "INSUMOS"},

                {"num":9, "id": 112, "data": "2026-02-14", "item": "COMPRAS MIX MATEUS", "qtd": 1, "unitario": 84.64, "total": 84.64, "categoria": "INSUMOS"},

                {"num":10, "id": 101, "data": "2026-02-15", "item": "OVOS", "qtd": 1, "unitario": 11.99, "total": 11.99, "categoria": "INSUMOS"},

                {"num":11, "id": 106, "data": "2026-02-15", "item": "LEITE", "qtd": 1, "unitario": 4.79, "total": 4.79, "categoria": "INSUMOS"},

                {"num":12, "id": 107, "data": "2026-02-15", "item": "OVOS", "qtd": 1, "unitario": 11.99, "total": 11.99, "categoria": "INSUMOS"},

                {"num":13, "id": 109, "data": "2026-02-15", "item": "LEITE", "qtd": 1, "unitario": 4, "total": 4, "categoria": "INSUMOS"},

                {"num":14, "id": 113, "data": "2026-02-15", "item": "CARIRI GAS", "qtd": 1, "unitario": 115, "total": 115, "categoria": "GASTOS GERAIS"}

            ],

            "investimentos": [

                {"id": 1, "data": "2026-01-15", "item": "M√°quina Vapor", "valor": 279.18},

                {"id": 2, "data": "2026-01-21", "item": "12 copos americanos", "valor": 17.9},

                {"id": 3, "data": "2026-01-21", "item": "Bico da Maquina", "valor": 13.75},

                {"id": 4, "data": "2026-01-27", "item": "Impulsionamento - Primeira Arte", "valor": 50},

                {"id": 5, "data": "2026-02-07", "item": "Rosca para bico", "valor": 6.5},

                {"id": 6, "data": "2026-02-07", "item": "100 tampas", "valor": 143},

                {"id": 7, "data": "2026-02-07", "item": "200 tampas", "valor": 282.48},

                {"id": 8, "data": "2026-02-07", "item": "20 ovos", "valor": 10.98},

                {"id": 9, "data": "2026-02-07", "item": "15 Leite Condensado", "valor": 74.7},

                {"id": 10, "data": "2026-02-07", "item": "100 Sacolas 17x27cm", "valor": 60},

                {"id": 11, "data": "2026-02-07", "item": "Adesivo Frente (bopp transparente) 300", "valor": 84.84},

                {"id": 12, "data": "2026-02-07", "item": "2kg de a√ßucar", "valor": 5.96},

                {"id": 14, "data": "2026-02-07", "item": "3 CAIXAS DE COPOS", "valor": 86.4},

                {"id": 13, "data": "2026-02-08", "item": "200 COLHERES", "valor": 50.89}

            ],

            "pagamentos": [

                {"id": 1771205787274, "data": "2026-02-16", "valor": 57, "tipo": "Divida"},

                {"id": 1771209832088, "data": "2026-02-16", "valor": 15, "tipo": "Divida"},

                {"id": 1771209850760, "data": "2026-02-16", "valor": 115, "tipo": "Divida"}

            ],

            "producoes": [],

            "estoqueMov": [

                {"id": 1771212023854, "data": "2026-02-16", "tipo": "entrada", "item": "pudim", "qtd": 104, "desc": "Ajuste R√°pido de Invent√°rio"},

                {"id": 1771212031633, "data": "2026-02-16", "tipo": "entrada", "item": "copo", "qtd": 144, "desc": "Ajuste R√°pido de Invent√°rio"},

                {"id": 1771212036139, "data": "2026-02-16", "tipo": "entrada", "item": "tampa", "qtd": 284, "desc": "Ajuste R√°pido de Invent√°rio"},

                {"id": 1771212047234, "data": "2026-02-16", "tipo": "entrada", "item": "sacola", "qtd": 92, "desc": "Ajuste R√°pido de Invent√°rio"},

                {"id": 1771212054902, "data": "2026-02-16", "tipo": "entrada", "item": "adesivo", "qtd": 154, "desc": "Ajuste R√°pido de Invent√°rio"},

                {"id": 1771212059145, "data": "2026-02-16", "tipo": "entrada", "item": "colher", "qtd": 182, "desc": "Ajuste R√°pido de Invent√°rio"}

            ]

        };

        

        let currentUserRole = 'viewer';

        let editingItem = { lista: null, id: null };

        const formatMoney = (val) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(val);

        const formatData = (date) => date ? new Date(date + "T00:00:00").toLocaleDateString('pt-BR') : '';



        const descTipoMap = { 'Divida': 'Giro (Abatimento D√≠vida)', 'MaoObra': 'Saque M√£o de Obra', 'Luyan': 'Saque Luyan', 'Beatriz': 'Saque Beatriz' };



        // =========================================================

        // UTILS: NUMERA√á√ÉO CONT√çNUA E TOAST

        // =========================================================

        const getNextNum = (arr) => arr.length > 0 ? Math.max(...arr.map(x => x.num || 0)) + 1 : 1;

        

        function showToast(msg, isError = false) {

            const toast = document.getElementById("toast");

            toast.innerText = msg;

            if(isError) toast.classList.add("error"); else toast.classList.remove("error");

            toast.classList.add("show");

            setTimeout(() => { toast.classList.remove("show"); }, 3000);

        }



        const globalCardsTemplate = `

        <div class="dashboard-grid">

            <div class="card" style="border-left-color: #3B82F6;"><h3>Faturamento Total</h3><p class="global-faturamento" style="color: #3B82F6;">R$ 0,00</p></div>

            <div class="card" style="border-left-color: #3B82F6;"><h3>Pudins Vendidos</h3><p class="global-pudins">0</p></div>

            <div class="card" style="border-left-color: #EF4444;"><h3>Insumo Fixo Total</h3><p class="global-insumos" style="color: #EF4444;">R$ 0,00</p></div>

            <div class="card" style="border-left-color: #EF4444;"><h3>Custos Gerais 15%</h3><p class="global-cg" style="color: #EF4444;">R$ 0,00</p></div>

            <div class="card" style="border-left-color: #EF4444;"><h3>M√£o de Obra 20%</h3><p class="global-mo" style="color: #EF4444;">R$ 0,00</p>

                <button class="btn-action-small" style="background:#EF4444" onclick="realizarSaque('MaoObra')">üí∏ Sacar M√£o Obra</button>

            </div>

            <div class="card" style="border-left-color: #8B5CF6;"><h3>Fundo 15%</h3><p class="global-fundo">R$ 0,00</p></div>

            <div class="card" style="border-left-color: #F59E0B;"><h3>S√≥cios: Luyan</h3><p class="global-luyan">R$ 0,00</p>

                <button class="btn-action-small" style="background:#F59E0B" onclick="realizarSaque('Luyan')">üí∏ Sacar Luyan</button>

            </div>

            <div class="card" style="border-left-color: #F59E0B;"><h3>S√≥cios: Beatriz</h3><p class="global-beatriz">R$ 0,00</p>

                <button class="btn-action-small" style="background:#F59E0B" onclick="realizarSaque('Beatriz')">üí∏ Sacar Beatriz</button>

            </div>

            <div class="card" style="border-left-color: #10B981; grid-column: 1 / -1; display: flex; justify-content: space-between; align-items: center; padding: 1.5rem 2rem;">

                <div><h3 style="margin-bottom: 0;">Giro em Caixa (Dispon√≠vel)</h3><p class="global-giro" style="color: #10B981; font-size: 2.2rem;">R$ 0,00</p></div>

                <button class="btn-action-small" style="width: auto; padding: 15px 30px; font-size: 1rem; background: #10B981;" onclick="realizarSaque('Divida')">üí∞ Abater D√≠vida</button>

            </div>

            <div class="card" style="grid-column: 1 / -1; text-align: center;"><h3>Falta p/ Pagar Investimento</h3><p class="global-roi" style="color: var(--danger)">R$ 0,00</p></div>

        </div>`;



        // =========================================================

        // INIT E AUTH

        // =========================================================

        function init() {

            document.getElementById('grid-saldos-varejo').innerHTML = globalCardsTemplate;

            document.getElementById('grid-saldos-atacado').innerHTML = globalCardsTemplate;

            resetDateInputs();

            updateAll();



            if(!isOnline) {

                document.getElementById('login-screen').style.display = 'none';

                document.getElementById('app-container').style.display = 'block';

                document.getElementById('user-badge').innerText = "üî¥ MODO OFFLINE (Sem Nuvem)";

                currentUserRole = 'admin'; 

                const saved = localStorage.getItem('pudimDuCaririDB');

                if(saved) {

                    try { let parsed = JSON.parse(saved); if(parsed.vendas && parsed.vendas.length > 0) db = loadDBData(parsed); } catch(e){}

                }

                updateAll();

            } else {

                firebase.auth().onAuthStateChanged((user) => {

                    if(user) {

                        if(user.email !== ADMIN_EMAIL && user.email !== VIEWER_EMAIL) {

                            alert("Usu√°rio n√£o autorizado!");

                            firebase.auth().signOut(); return;

                        }



                        document.getElementById('login-screen').style.display = 'none';

                        document.getElementById('app-container').style.display = 'block';

                        

                        if(user.email === ADMIN_EMAIL) {

                            currentUserRole = 'admin';

                            document.body.classList.remove('viewer-mode');

                            document.getElementById('user-badge').innerText = "üëë ADMIN: " + user.email;

                        } else {

                            currentUserRole = 'viewer';

                            document.body.classList.add('viewer-mode');

                            document.getElementById('user-badge').innerText = "üëÅÔ∏è VISUALIZADOR: " + user.email;

                        }



                        firebase.database().ref('pudimAppDB').on('value', (snapshot) => {

                            if(snapshot.exists() && snapshot.val().vendas && snapshot.val().vendas.length > 0) {

                                db = loadDBData(snapshot.val());

                                localStorage.setItem('pudimDuCaririDB', JSON.stringify(db)); 

                                updateAll();

                            } else {

                                if(currentUserRole === 'admin') firebase.database().ref('pudimAppDB').set(db);

                            }

                        });

                    } else {

                        document.getElementById('login-screen').style.display = 'flex';

                        document.getElementById('app-container').style.display = 'none';

                    }

                });

            }

        }



        function fazerLogin() {

            const e = document.getElementById('login-email').value;

            const p = document.getElementById('login-password').value;

            firebase.auth().signInWithEmailAndPassword(e, p).catch(err => {

                document.getElementById('login-error').style.display = 'block';

            });

        }



        function fazerLogout() {

            if(isOnline) firebase.auth().signOut(); else alert("Voc√™ est√° no modo offline.");

        }



        function loadDBData(data) {

            const addMissingNums = (arr) => { arr.sort((a,b)=>new Date(a.data)-new Date(b.data)).forEach((x,i)=>{ if(!x.num) x.num=i+1; }); };

            if(!data.pagamentos) data.pagamentos = []; 

            if(!data.producoes) data.producoes = [];

            if(!data.estoqueMov) data.estoqueMov = [];

            if(!data.vendas) data.vendas = [];

            if(!data.atacado) data.atacado = [];

            if(!data.despesas) data.despesas = [];

            if(!data.investimentos) data.investimentos = [];

            if(data.config === undefined) data.config = { precoUnd: 15, precoCombo: 40, custoInsumo: 5.95, taxaCredIns: 4.98, taxaCredApr: 3.09, taxaDebIns: 1.99, taxaDebApr: 0.89, custoCopo: 1.50, taxaCartaoOnline: 2.99 };

            if(data.config.taxaCartaoOnline === undefined) data.config.taxaCartaoOnline = 2.99;

            

            // Corrige n√∫meros faltantes em DBs antigos

            addMissingNums(data.vendas); addMissingNums(data.atacado); addMissingNums(data.despesas); addMissingNums(data.producoes);

            return data;

        }



        function saveData() {

            if(currentUserRole !== 'admin') return alert("Apenas Administradores podem alterar os dados.");

            localStorage.setItem('pudimDuCaririDB', JSON.stringify(db)); 

            updateAll(); 

            if(isOnline) {

                firebase.database().ref('pudimAppDB').set(db).catch(err => { alert("Erro ao sincronizar na nuvem: " + err.message); });

            }

        }



        function resetDateInputs() {

            const hoje = new Date().toISOString().split('T')[0];

            document.querySelectorAll('input[type="date"]').forEach(el => el.value = hoje);

        }



        function switchTab(tabId) {

            document.querySelectorAll('.content').forEach(el => el.classList.remove('active'));

            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));

            document.getElementById(tabId).classList.add('active');

            document.querySelectorAll('.tab-btn').forEach(btn => {

                if(btn.getAttribute('onclick').includes(tabId)) btn.classList.add('active');

            });

            updateAll();

        }

        

        function exportDataBlob() {

            const dataStr = JSON.stringify(db, null, 2);

            const blob = new Blob([dataStr], { type: "application/json" });

            const url = URL.createObjectURL(blob);

            const downloadAnchorNode = document.createElement('a');

            downloadAnchorNode.href = url;

            downloadAnchorNode.download = "backup_pudim_du_cariri.json";

            document.body.appendChild(downloadAnchorNode);

            downloadAnchorNode.click();

            document.body.removeChild(downloadAnchorNode);

            URL.revokeObjectURL(url);

        }



        function importData(event) {

            if(currentUserRole !== 'admin') return alert("Apenas Administradores podem restaurar backups.");

            const file = event.target.files[0];

            if (!file) return;

            const reader = new FileReader();

            reader.onload = function(e) {

                try {

                    db = loadDBData(JSON.parse(e.target.result));

                    saveData(); showToast("Backup restaurado e sincronizado!");

                } catch (err) { showToast("Erro ao ler o arquivo JSON.", true); }

                event.target.value = ''; 

            };

            reader.readAsText(file);

        }



        // ================= EXPORTAR EXCEL =================

        function exportarExcel() {

            if (typeof XLSX === 'undefined') return alert("Biblioteca do Excel n√£o carregou. Verifique a internet.");

            const wb = XLSX.utils.book_new();



            // Aba 1: Varejo

            const wsVarData = [["N¬∫ Pedido", "Data", "Produto", "L√≠quido (R$)", "Insumo Fixo (R$)", "Custos Gerais 15% (R$)", "M√£o Obra 20% (R$)", "Lucro Restante (R$)", "Giro 50% (R$)", "Fundo 15% (R$)", "S√≥cio Luyan 17.5% (R$)", "S√≥cia Beatriz 17.5% (R$)"]];

            db.vendas.sort((a,b)=>new Date(a.data)-new Date(b.data)).forEach(v => {

                const q = (v.produto.includes('Combo') ? 3 : 1) * (v.qtd || 1);

                const ins = q * db.config.custoInsumo;

                const base = v.valorLiquido - ins;

                const cg = base * 0.15; const mo = base * 0.20; const lucro = base - cg - mo;

                wsVarData.push([v.num, v.data, v.produto, v.valorLiquido, ins, cg, mo, lucro, lucro*0.50, lucro*0.15, lucro*0.175, lucro*0.175]);

            });

            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(wsVarData), "Rateio Varejo");



            // Aba 2: Atacado

            const wsAtaData = [["N¬∫ Pedido", "Data", "Cliente", "L√≠quido (R$)", "Insumo Fixo (R$)", "Custos Gerais 15% (R$)", "M√£o Obra 20% (R$)", "Lucro Restante (R$)", "Giro 50% (R$)", "Fundo 15% (R$)", "S√≥cio Luyan 17.5% (R$)", "S√≥cia Beatriz 17.5% (R$)"]];

            db.atacado.filter(a=>a.status==='PAGO').sort((a,b)=>new Date(a.data)-new Date(b.data)).forEach(a => {

                const liq = a.totalLiquido !== undefined ? a.totalLiquido : (a.total !== undefined ? a.total : (a.qtd*a.unitario) - (a.desconto||0));

                const ins = Math.max(0, (a.qtd * db.config.custoInsumo) - ((a.coposDevolvidos || 0) * (db.config.custoCopo || 1.80)));

                const base = liq - ins; const cg = base * 0.15; const mo = base * 0.20; const lucro = base - cg - mo;

                wsAtaData.push([a.num, a.data, a.cliente, liq, ins, cg, mo, lucro, lucro*0.50, lucro*0.15, lucro*0.175, lucro*0.175]);

            });

            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(wsAtaData), "Rateio Atacado");



            // Aba 3: Despesas

            const wsDespData = [["N¬∫ Despesa", "Data", "Item", "Quantidade", "Valor Unit√°rio (R$)", "Total Pago (R$)", "Categoria"]];

            db.despesas.sort((a,b)=>new Date(a.data)-new Date(b.data)).forEach(d => {

                wsDespData.push([d.num, d.data, d.item, d.qtd, d.unitario, d.total, d.categoria]);

            });

            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(wsDespData), "Despesas");



            XLSX.writeFile(wb, "PudimDuCariri_Relatorio_Financeiro.xlsx");

            showToast("Planilha Excel Gerada!");

        }



        function loadConfigUI() {

            document.getElementById('cfg-preco-und').value = db.config.precoUnd;

            document.getElementById('cfg-preco-combo').value = db.config.precoCombo;

            document.getElementById('cfg-custo-insumo').value = db.config.custoInsumo;

            document.getElementById('cfg-custo-copo').value = db.config.custoCopo;

            document.getElementById('cfg-taxa-cred-ins').value = db.config.taxaCredIns;

            document.getElementById('cfg-taxa-cred-apr').value = db.config.taxaCredApr;

            document.getElementById('cfg-taxa-deb-ins').value = db.config.taxaDebIns;

            document.getElementById('cfg-taxa-deb-apr').value = db.config.taxaDebApr;

            document.getElementById('cfg-taxa-cartao-online').value = db.config.taxaCartaoOnline || 2.99;

        }



        function saveConfig() {

            db.config.precoUnd = parseFloat(document.getElementById('cfg-preco-und').value) || 0;

            db.config.precoCombo = parseFloat(document.getElementById('cfg-preco-combo').value) || 0;

            db.config.custoInsumo = parseFloat(document.getElementById('cfg-custo-insumo').value) || 0;

            db.config.custoCopo = parseFloat(document.getElementById('cfg-custo-copo').value) || 0;

            db.config.taxaCredIns = parseFloat(document.getElementById('cfg-taxa-cred-ins').value) || 0;

            db.config.taxaCredApr = parseFloat(document.getElementById('cfg-taxa-cred-apr').value) || 0;

            db.config.taxaDebIns = parseFloat(document.getElementById('cfg-taxa-deb-ins').value) || 0;

            db.config.taxaDebApr = parseFloat(document.getElementById('cfg-taxa-deb-apr').value) || 0;

            db.config.taxaCartaoOnline = parseFloat(document.getElementById('cfg-taxa-cartao-online').value) || 0;

            saveData(); showToast("Configura√ß√µes Salvas!");

        }



        function getTaxaPercent(pgto) {

            switch(pgto) {

                case 'Credito Insercao': return db.config.taxaCredIns;

                case 'Credito Aproximacao': return db.config.taxaCredApr;

                case 'Debito Insercao': return db.config.taxaDebIns;

                case 'Debito Aproximacao': return db.config.taxaDebApr;

                case 'Cartao Online': return db.config.taxaCartaoOnline || 2.99;

                default: return 0;

            }

        }



        function calcDescAtacado() {

            let copos = parseInt(document.getElementById('a-copos').value) || 0;

            document.getElementById('a-desconto').value = (copos >= 12) ? copos.toFixed(2) : '0.00';

        }



        function toggleAsaas() {

            const pgto = document.getElementById('v-pgto').value;

            const asaasGroup = document.getElementById('asaas-group');

            if(pgto === 'PIX') { asaasGroup.style.display = 'flex'; } 

            else { asaasGroup.style.display = 'none'; document.getElementById('v-asaas').checked = false; }

        }



        function prepararEdicao(lista, id) {

            const item = db[lista].find(i => i.id === id);

            if(!item) return;

            editingItem = { lista, id };



            if(lista === 'vendas') { 

                switchTab('vendas'); 

                document.getElementById('v-data').value = item.data; 

                document.getElementById('v-produto').value = item.produto.includes('Combo') ? 'Combo' : 'Unidade'; 

                document.getElementById('v-pgto').value = item.pgto; 

                document.getElementById('v-asaas').checked = item.asaas || false; toggleAsaas();

                document.getElementById('v-entrega').value = item.entrega || 0; 

                document.getElementById('v-qtd').value = item.qtd || 1; 

                document.getElementById('v-desconto').value = item.desconto || 0; 

                document.getElementById('btn-submit-vendas').innerText = "Atualizar Venda"; 

            }

            else if(lista === 'atacado') { switchTab('atacado'); document.getElementById('a-data').value = item.data; document.getElementById('a-cliente').value = item.cliente; document.getElementById('a-qtd').value = item.qtd; document.getElementById('a-valor').value = item.unitario; document.getElementById('a-copos').value = item.coposDevolvidos || 0; document.getElementById('a-desconto').value = item.desconto || 0; document.getElementById('a-status').value = item.status; document.getElementById('btn-submit-atacado').innerText = "Atualizar Atacado"; }

            else if(lista === 'despesas') { switchTab('despesas'); document.getElementById('d-data').value = item.data; document.getElementById('d-item').value = item.item; document.getElementById('d-qtd').value = item.qtd; document.getElementById('d-valor').value = item.unitario; document.getElementById('d-categoria').value = item.categoria; document.getElementById('btn-submit-despesas').innerText = "Atualizar Despesa"; }

            else if(lista === 'investimentos') { switchTab('investimentos'); document.getElementById('i-data').value = item.data; document.getElementById('i-item').value = item.item; document.getElementById('i-valor').value = item.valor; document.getElementById('btn-submit-investimentos').innerText = "Atualizar Investimento"; }

            else if(lista === 'pagamentos') { switchTab('extrato'); document.getElementById('p-data').value = item.data; document.getElementById('p-valor').value = item.valor; document.getElementById('p-tipo').value = item.tipo || 'Divida'; document.getElementById('btn-submit-pagamentos').innerText = "Atualizar Lan√ßamento"; }

            else if(lista === 'producoes') { switchTab('estoque'); document.getElementById('prod-data').value = item.data; document.getElementById('prod-qtd').value = item.qtd; document.getElementById('btn-submit-producao').innerText = "Atualizar Produ√ß√£o"; }

            else if(lista === 'estoqueMov') { switchTab('estoque'); document.getElementById('mov-data').value = item.data; document.getElementById('mov-tipo').value = item.tipo; document.getElementById('mov-item').value = item.item; document.getElementById('mov-qtd').value = item.qtd; document.getElementById('mov-desc').value = item.desc; document.getElementById('btn-submit-mov').innerText = "Atualizar Ajuste"; }

            window.scrollTo({ top: 0, behavior: 'smooth' });

        }



        function finalizarEdicao(lista, novoItem, btnId, txtOriginal, msgToast) {

            if(editingItem.lista === lista) {

                const index = db[lista].findIndex(i => i.id === editingItem.id);

                if(index > -1) db[lista][index] = { ...db[lista][index], ...novoItem };

                editingItem = { lista: null, id: null };

                document.getElementById(btnId).innerText = txtOriginal;

            } else { db[lista].push(novoItem); }

            saveData(); showToast(msgToast);

        }



        function addVenda() {

            const data = document.getElementById('v-data').value; const produtoStr = document.getElementById('v-produto').value; const pgto = document.getElementById('v-pgto').value; const isAsaas = document.getElementById('v-asaas').checked;

            const qtd = parseInt(document.getElementById('v-qtd').value) || 1; const desconto = parseFloat(document.getElementById('v-desconto').value) || 0; const entrega = parseFloat(document.getElementById('v-entrega').value) || 0;

            if(!data) return alert('Preencha a data');

            const precoBase = produtoStr === 'Combo' ? db.config.precoCombo : db.config.precoUnd;

            const produtoNome = produtoStr === 'Combo' ? 'Combo (3 und)' : 'Pudim 1 Und';

            const valorBruto = precoBase * qtd; const valorCobradoMaq = valorBruto - desconto; 

            

            let valorTaxa = (pgto === 'PIX' && isAsaas) ? 0.14 : (valorCobradoMaq * (getTaxaPercent(pgto) / 100));

            

            let oldNum = getNextNum(db.vendas);

            if(editingItem.lista === 'vendas') { const old = db.vendas.find(i=>i.id===editingItem.id); if(old) oldNum = old.num; }



            finalizarEdicao('vendas', { id: (editingItem.lista === 'vendas' ? editingItem.id : Date.now()), num: oldNum, data, produto: produtoNome, pgto, asaas: isAsaas, qtd, desconto, valorBruto, valorTaxa, valorLiquido: valorCobradoMaq - valorTaxa, entrega }, 'btn-submit-vendas', 'Adicionar Venda', 'Venda Adicionada!');

            document.getElementById('v-qtd').value = '1'; document.getElementById('v-desconto').value = '0'; document.getElementById('v-entrega').value = '0'; document.getElementById('v-asaas').checked = false;

        }



        function addAtacado() {

            const data = document.getElementById('a-data').value; const cliente = document.getElementById('a-cliente').value; const qtd = parseInt(document.getElementById('a-qtd').value); const unitario = parseFloat(document.getElementById('a-valor').value);

            const coposDevolvidos = parseInt(document.getElementById('a-copos').value) || 0; const desconto = parseFloat(document.getElementById('a-desconto').value) || 0; const status = document.getElementById('a-status').value;

            if(!data || !cliente || !qtd || !unitario || isNaN(unitario)) return alert('Preencha os campos obrigat√≥rios corretamente.');

            const totalBruto = qtd * unitario;

            

            let oldNum = getNextNum(db.atacado);

            if(editingItem.lista === 'atacado') { const old = db.atacado.find(i=>i.id===editingItem.id); if(old) oldNum = old.num; }



            finalizarEdicao('atacado', { id: (editingItem.lista==='atacado'?editingItem.id:Date.now()), num: oldNum, data, cliente, qtd, unitario, coposDevolvidos, desconto, totalBruto: totalBruto, totalLiquido: totalBruto - desconto, status }, 'btn-submit-atacado', 'Adicionar Venda Atacado', 'Pedido Atacado Salvo!');

            document.getElementById('a-cliente').value = ''; document.getElementById('a-qtd').value = ''; document.getElementById('a-valor').value = ''; document.getElementById('a-copos').value = '0'; document.getElementById('a-desconto').value = '0';

        }



        function addDespesa() {

            const data = document.getElementById('d-data').value; const item = document.getElementById('d-item').value; const qtd = parseFloat(document.getElementById('d-qtd').value); const unitario = parseFloat(document.getElementById('d-valor').value); const categoria = document.getElementById('d-categoria').value;

            if(!data || !item || !qtd || !unitario || isNaN(unitario)) return alert('Preencha os campos corretamente.');

            

            let oldNum = getNextNum(db.despesas);

            if(editingItem.lista === 'despesas') { const old = db.despesas.find(i=>i.id===editingItem.id); if(old) oldNum = old.num; }



            finalizarEdicao('despesas', { id: (editingItem.lista==='despesas'?editingItem.id:Date.now()), num: oldNum, data, item, qtd, unitario, total: qtd * unitario, categoria }, 'btn-submit-despesas', 'Adicionar Despesa', 'Despesa Lan√ßada!');

            document.getElementById('d-item').value = ''; document.getElementById('d-qtd').value = ''; document.getElementById('d-valor').value = '';

        }



        function addInvestimento() {

            const data = document.getElementById('i-data').value; const item = document.getElementById('i-item').value; const valor = parseFloat(document.getElementById('i-valor').value);

            if(!data || !item || !valor || isNaN(valor)) return alert('Preencha os campos corretamente.');

            finalizarEdicao('investimentos', { id: (editingItem.lista==='investimentos'?editingItem.id:Date.now()), data, item, valor }, 'btn-submit-investimentos', 'Adicionar Investimento', 'Investimento Adicionado!');

            document.getElementById('i-item').value = ''; document.getElementById('i-valor').value = '';

        }



        function addPagamento() {

            const data = document.getElementById('p-data').value; const valor = parseFloat(document.getElementById('p-valor').value); const tipo = document.getElementById('p-tipo').value;

            if(!data || !valor || isNaN(valor)) return alert('Preencha os campos corretamente.');

            finalizarEdicao('pagamentos', { id: (editingItem.lista==='pagamentos'?editingItem.id:Date.now()), data, valor, tipo }, 'btn-submit-pagamentos', 'Registrar Retirada Manual', 'Saque Registrado!');

            document.getElementById('p-valor').value = '';

        }



        function realizarSaque(tipoRequest) {

            let saldo = parseFloat(document.querySelector(`.global-${tipoRequest.toLowerCase().replace('maoobra', 'mo')}`).innerText.replace('R$','').replace('.','').replace(',','.').trim());

            if(tipoRequest === 'Divida') saldo = parseFloat(document.querySelector('.global-giro').innerText.replace('R$','').replace('.','').replace(',','.').trim());



            let nomeCaixa = descTipoMap[tipoRequest] || tipoRequest;



            let valor = prompt(`Seu Saldo Livre Atual na caixa [${nomeCaixa}] √© de: ${formatMoney(saldo)}\n\nDigite o valor EXATO que deseja retirar/abater agora:`);

            if(!valor) return;

            valor = parseFloat(valor.replace(',', '.'));

            if(isNaN(valor) || valor <= 0) return alert("Valor inv√°lido. Use ponto em vez de v√≠rgula se necess√°rio.");



            db.pagamentos.push({ id: Date.now(), data: new Date().toISOString().split('T')[0], valor: valor, tipo: tipoRequest });

            saveData(); showToast(`Saque de ${formatMoney(valor)} registrado com sucesso!`);

        }



        function addProducao() {

            const data = document.getElementById('prod-data').value; const qtd = parseInt(document.getElementById('prod-qtd').value);

            if(!data || !qtd || isNaN(qtd)) return alert("Preencha a data e a quantidade de receitas!");

            

            let oldNum = getNextNum(db.producoes);

            if(editingItem.lista === 'producoes') { const old = db.producoes.find(i=>i.id===editingItem.id); if(old) oldNum = old.num; }



            finalizarEdicao('producoes', { id: (editingItem.lista==='producoes'?editingItem.id:Date.now()), num: oldNum, data, qtd }, 'btn-submit-producao', 'Registrar Produ√ß√£o', 'Receita Registrada!');

            document.getElementById('prod-qtd').value = '1';

        }



        function addEstoqueMov() {

            const data = document.getElementById('mov-data').value; const tipo = document.getElementById('mov-tipo').value; const item = document.getElementById('mov-item').value; const qtd = parseFloat(document.getElementById('mov-qtd').value);

            const desc = document.getElementById('mov-desc').value || (tipo === 'entrada' ? 'Entrada Manual' : 'Sa√≠da Manual');

            if(!data || !qtd || isNaN(qtd)) return alert("Preencha a data e a quantidade corretamente!");

            finalizarEdicao('estoqueMov', { id: (editingItem.lista==='estoqueMov'?editingItem.id:Date.now()), data, tipo, item, qtd, desc }, 'btn-submit-mov', 'Lan√ßar Ajuste', 'Ajuste Manual Salvo!');

            document.getElementById('mov-qtd').value = ''; document.getElementById('mov-desc').value = '';

        }



        function ajustarEstoqueRapido(itemKey, nomeItem) {

            let atual = calcularSaldosEstoque()[itemKey];

            let novo = prompt(`Estoque atual de ${nomeItem}: ${atual}\n\nDigite a quantidade REAL que voc√™ tem agora:`, atual);

            if(novo === null || novo === "") return; 

            novo = parseFloat(novo.replace(',', '.'));

            if(isNaN(novo)) return alert("Valor inv√°lido.");

            let diferenca = novo - atual; if(diferenca === 0) return;

            

            db.estoqueMov.push({ id: Date.now(), data: new Date().toISOString().split('T')[0], tipo: diferenca > 0 ? 'entrada' : 'saida', item: itemKey, qtd: Math.abs(diferenca), desc: 'Ajuste R√°pido' });

            saveData(); showToast("Estoque Ajustado!");

        }



        function deletarItem(lista, id) {

            if(confirm("Tem certeza que deseja apagar este registro?")) {

                db[lista] = db[lista].filter(item => item.id !== id);

                saveData(); showToast("Registro Apagado!", true);

            }

        }



        function updateAll() {

            renderEstoque();

            renderTabelas();

            renderRateio();

            updateDashboard();

        }



        function calcularSaldosEstoque() {

            let saldos = { pudim: 0, leite_condensado: 0, leite_integral: 0, ovos: 0, acucar: 0, copo: 0, tampa: 0, sacola: 0, adesivo: 0, colher: 0 };

            

            db.estoqueMov.forEach(m => { 

                if(m.tipo === 'entrada') saldos[m.item] += m.qtd; 

                else saldos[m.item] -= m.qtd; 

            });

            

            db.producoes.forEach(p => { 

                saldos.pudim += p.qtd*6; 

                saldos.leite_condensado -= p.qtd*1; 

                saldos.leite_integral -= p.qtd*400; 

                saldos.ovos -= p.qtd*3; 

                saldos.acucar -= p.qtd*200; 

                

                // Embalagens usadas na produ√ß√£o

                saldos.copo -= p.qtd*6;

                saldos.tampa -= p.qtd*6;

                saldos.adesivo -= p.qtd*6;

            });

            

            db.vendas.forEach(v => { 

                const p = (v.produto.includes('Combo')?3:1)*(v.qtd||1); 

                saldos.pudim -= p; 

                

                // Embalagens da venda varejo

                saldos.colher -= p; 

                saldos.sacola -= 1; 

            });

            

            db.atacado.forEach(a => { 

                saldos.pudim -= a.qtd; 

                if(a.coposDevolvidos) saldos.copo += a.coposDevolvidos; 

            });

            

            return saldos;

        }



        function renderEstoque() {

            let saldos = calcularSaldosEstoque();



            const mapKeys = ['pudim', 'leite_condensado', 'leite_integral', 'ovos', 'acucar', 'copo', 'tampa', 'sacola', 'adesivo', 'colher'];

            mapKeys.forEach(k => {

                let el = document.getElementById('est-' + k);

                if(el) {

                    let val = saldos[k];

                    let suffix = (k==='leite_integral') ? ' ml' : (k==='acucar' ? ' g' : ' un');

                    el.innerText = val + suffix;

                    

                    el.classList.remove('status-red', 'status-yellow', 'status-green', 'status-blink');

                    

                    let status = 'status-green';

                    if (k === 'pudim') { if (val <= 0) status = 'status-red'; else if (val < 10) status = 'status-yellow'; }

                    else if (k === 'leite_condensado') { if (val <= 0) status = 'status-red'; else if (val <= 2) status = 'status-yellow'; }

                    else if (k === 'leite_integral') { if (val <= 0) status = 'status-red'; else if (val <= 800) status = 'status-yellow'; }

                    else if (k === 'ovos') { if (val <= 0) status = 'status-red'; else if (val <= 6) status = 'status-yellow'; }

                    else if (k === 'acucar') { if (val <= 0) status = 'status-red'; else if (val <= 400) status = 'status-yellow'; }

                    else if (k === 'copo') { if (val <= 0) status = 'status-red'; else if (val < 24) status = 'status-yellow'; }

                    else if (k === 'tampa') { if (val < 70) status = 'status-red'; else if (val < 150) status = 'status-yellow'; }

                    else if (k === 'sacola') { if (val <= 0) status = 'status-red'; else if (val < 50) status = 'status-yellow'; }

                    else if (k === 'adesivo') { if (val < 70) status = 'status-red'; else if (val < 150) status = 'status-yellow'; }

                    else if (k === 'colher') { if (val < 70) status = 'status-red'; else if (val < 150) status = 'status-yellow'; }



                    el.classList.add(status);

                    if (val < 0) el.classList.add('status-blink');

                }

            });



            const tbProd = document.getElementById('tbody-producoes');

            tbProd.innerHTML = '';

            db.producoes.sort((a,b)=>new Date(b.data)-new Date(a.data)).forEach(p => {

                tbProd.innerHTML += `<tr><td>#${p.num||'-'}</td><td>${formatData(p.data)}</td><td>${p.qtd} Receitas</td>

                <td style="color:var(--success); font-weight:bold">+${p.qtd*6} Pudins</td>

                <td><button class="btn-edit" onclick="prepararEdicao('producoes', ${p.id})">‚úèÔ∏è</button><button class="btn-delete" onclick="deletarItem('producoes', ${p.id})">üóëÔ∏è</button></td></tr>`;

            });



            const mapItemNames = {

                leite_condensado: "Leite Condensado", leite_integral: "Leite Integral", ovos: "Ovos", acucar: "A√ß√∫car",

                copo: "Copo Americano", tampa: "Tampas", sacola: "Sacolas", adesivo: "Adesivos", colher: "Colheres", pudim: "Pudins Prontos"

            };

            const tbMov = document.getElementById('tbody-estoquemov');

            tbMov.innerHTML = '';

            db.estoqueMov.sort((a,b)=>new Date(b.data)-new Date(a.data)).forEach(m => {

                const color = m.tipo === 'entrada' ? 'var(--success)' : 'var(--danger)';

                const signal = m.tipo === 'entrada' ? '+' : '-';

                tbMov.innerHTML += `<tr><td>${formatData(m.data)}</td><td>${mapItemNames[m.item]}</td>

                <td style="color:${color}; font-weight:bold">${signal}${m.qtd}</td><td>${m.desc}</td>

                <td><button class="btn-edit" onclick="prepararEdicao('estoqueMov', ${m.id})">‚úèÔ∏è</button><button class="btn-delete" onclick="deletarItem('estoqueMov', ${m.id})">üóëÔ∏è</button></td></tr>`;

            });

        }



        function renderTabelas() {

            const tbVendas = document.getElementById('tbody-vendas');

            tbVendas.innerHTML = '';

            db.vendas.sort((a,b)=>new Date(b.data)-new Date(a.data)).forEach(v => {

                const entrega = v.entrega || 0;

                const desconto = v.desconto || 0;

                const labelAsaas = v.asaas ? ' <span style="font-size:0.7rem;color:#D97706">(Asaas)</span>' : '';

                tbVendas.innerHTML += `<tr>

                    <td style="font-weight:bold; color:var(--secondary)">#${v.num||'-'}</td><td>${formatData(v.data)}</td><td>${v.produto}</td><td>${v.qtd||1}</td>

                    <td style="color:var(--primary)">${desconto > 0 ? '-'+formatMoney(desconto) : '-'}</td>

                    <td>${v.pgto}${labelAsaas}</td><td>${formatMoney(v.valorBruto)}</td>

                    <td style="color:red">-${formatMoney(v.valorTaxa)}</td>

                    <td style="color:#059669">+${formatMoney(entrega)}</td>

                    <td style="font-weight:bold">${formatMoney(v.valorLiquido)}</td>

                    <td style="white-space: nowrap;"><button class="btn-edit" onclick="prepararEdicao('vendas', ${v.id})">‚úèÔ∏è</button><button class="btn-delete" onclick="deletarItem('vendas', ${v.id})">üóëÔ∏è</button></td>

                </tr>`;

            });



            const tbAtacado = document.getElementById('tbody-atacado');

            tbAtacado.innerHTML = '';

            db.atacado.sort((a,b)=>new Date(b.data)-new Date(a.data)).forEach(v => {

                const corStatus = v.status === 'PAGO' ? 'green' : 'red';

                const copos = v.coposDevolvidos || 0;

                const desconto = v.desconto || 0;

                const bruto = v.totalBruto !== undefined ? v.totalBruto : (v.qtd * v.unitario);

                const liq = v.totalLiquido !== undefined ? v.totalLiquido : (v.total !== undefined ? v.total : bruto - (v.desconto||0));



                tbAtacado.innerHTML += `<tr><td style="font-weight:bold; color:var(--secondary)">#${v.num||'-'}</td><td>${formatData(v.data)}</td><td>${v.cliente}</td><td>${v.qtd}</td><td>${formatMoney(v.unitario)}</td>

                <td>${formatMoney(bruto)}</td><td style="color:red">-${formatMoney(desconto)}<br><small>(${copos} un)</small></td>

                <td style="font-weight:bold">${formatMoney(liq)}</td><td style="color:${corStatus}; font-weight:bold">${v.status}</td>

                <td style="white-space: nowrap;"><button class="btn-edit" onclick="prepararEdicao('atacado', ${v.id})">‚úèÔ∏è</button><button class="btn-delete" onclick="deletarItem('atacado', ${v.id})">üóëÔ∏è</button></td></tr>`;

            });



            const tbDesp = document.getElementById('tbody-despesas');

            tbDesp.innerHTML = '';

            db.despesas.sort((a,b)=>new Date(b.data)-new Date(a.data)).forEach(d => {

                tbDesp.innerHTML += `<tr><td style="font-weight:bold; color:var(--secondary)">#${d.num||'-'}</td><td>${formatData(d.data)}</td><td>${d.item}</td><td>${d.qtd}</td><td>${formatMoney(d.unitario)}</td><td style="color:red; font-weight:bold">${formatMoney(d.total)}</td><td>${d.categoria}</td>

                <td style="white-space: nowrap;"><button class="btn-edit" onclick="prepararEdicao('despesas', ${d.id})">‚úèÔ∏è</button><button class="btn-delete" onclick="deletarItem('despesas', ${d.id})">üóëÔ∏è</button></td></tr>`;

            });



            const tbInv = document.getElementById('tbody-investimentos');

            tbInv.innerHTML = '';

            db.investimentos.sort((a,b)=>new Date(b.data)-new Date(a.data)).forEach(i => {

                tbInv.innerHTML += `<tr><td>${formatData(i.data)}</td><td>${i.item}</td><td style="color:red; font-weight:bold">${formatMoney(i.valor)}</td>

                <td style="white-space: nowrap;"><button class="btn-edit" onclick="prepararEdicao('investimentos', ${i.id})">‚úèÔ∏è</button><button class="btn-delete" onclick="deletarItem('investimentos', ${i.id})">üóëÔ∏è</button></td></tr>`;

            });



            const tbPag = document.getElementById('tbody-pagamentos');

            tbPag.innerHTML = '';

            let timeline = [];

            db.vendas.forEach(v => { const q = (v.produto.includes('Combo') ? 3 : 1) * (v.qtd || 1); const base = v.valorLiquido - (q * db.config.custoInsumo); const cg = base * 0.15; const mo = base * 0.20; const lucro = base - cg - mo; timeline.push({ id: v.id, data: v.data, tipoAcao: 'ganho', giro: lucro * 0.50, mo: mo, luyan: lucro * 0.175, beatriz: lucro * 0.175 }); });

            db.atacado.forEach(a => { if (a.status !== 'PAGO') return; const bruto = a.totalBruto !== undefined ? a.totalBruto : (a.qtd * a.unitario); const liq = a.totalLiquido !== undefined ? a.totalLiquido : (a.total !== undefined ? a.total : bruto - (a.desconto||0)); const insBase = a.qtd * db.config.custoInsumo; const abatCopos = (a.coposDevolvidos || 0) * (db.config.custoCopo || 1.80); const ins = Math.max(0, insBase - abatCopos); const base = liq - ins; const cg = base * 0.15; const mo = base * 0.20; const lucro = base - cg - mo; timeline.push({ id: a.id, data: a.data, tipoAcao: 'ganho', giro: lucro * 0.50, mo: mo, luyan: lucro * 0.175, beatriz: lucro * 0.175 }); });

            db.pagamentos.forEach(p => { timeline.push({ id: p.id, data: p.data, tipoAcao: 'saque', obj: p }); });



            timeline.sort((a, b) => { const dateA = new Date(a.data).getTime(); const dateB = new Date(b.data).getTime(); if(dateA === dateB) return a.id - b.id; return dateA - dateB; });



            let saldos = { Divida: 0, MaoObra: 0, Luyan: 0, Beatriz: 0 };

            let renderListaPagamentos = [];



            timeline.forEach(t => {

                if(t.tipoAcao === 'ganho') { saldos.Divida += t.giro; saldos.MaoObra += t.mo; saldos.Luyan += t.luyan; saldos.Beatriz += t.beatriz; } 

                else if(t.tipoAcao === 'saque') {

                    let caixaType = t.obj.tipo || 'Divida';

                    let saldoAnterior = saldos[caixaType] || 0;

                    saldos[caixaType] -= t.obj.valor;

                    renderListaPagamentos.push({ ...t.obj, saldoAnterior: saldoAnterior, saldoAtual: saldos[caixaType] });

                }

            });



            renderListaPagamentos.sort((a, b) => { const dateA = new Date(a.data).getTime(); const dateB = new Date(b.data).getTime(); if(dateA === dateB) return b.id - a.id; return dateB - dateA; });



            renderListaPagamentos.forEach(p => {

                tbPag.innerHTML += `<tr>

                    <td>${formatData(p.data)}</td><td style="font-weight:bold; color:var(--secondary)">${descTipoMap[p.tipo || 'Divida']}</td>

                    <td style="color:#6B7280">${formatMoney(p.saldoAnterior)}</td><td style="color:var(--danger); font-weight:bold">-${formatMoney(p.valor)}</td>

                    <td style="color:${p.saldoAtual < 0 ? 'var(--danger)' : 'var(--success)'}; font-weight:bold">${formatMoney(p.saldoAtual)}</td>

                    <td style="white-space: nowrap;"><button class="btn-edit" onclick="prepararEdicao('pagamentos', ${p.id})">‚úèÔ∏è</button><button class="btn-delete" onclick="deletarItem('pagamentos', ${p.id})">üóëÔ∏è</button></td>

                </tr>`;

            });

        }



        function renderRateio() {

            let htmlVar = '';

            let vLiq=0, vIns=0, vCg=0, vMo=0, vLucro=0, vGiro=0, vFundo=0, vLu=0, vBea=0;



            db.vendas.sort((a,b)=>new Date(b.data)-new Date(a.data)).forEach(v => {

                const q = (v.produto.includes('Combo') ? 3 : 1) * (v.qtd || 1);

                const ins = q * db.config.custoInsumo; const base = v.valorLiquido - ins;

                const cg = base * 0.15; const mo = base * 0.20; const lucro = base - cg - mo;

                const giro = lucro * 0.50, fundo = lucro * 0.15, luyan = lucro * 0.175, beatriz = lucro * 0.175;



                vLiq+=v.valorLiquido; vIns+=ins; vCg+=cg; vMo+=mo; vLucro+=lucro; vGiro+=giro; vFundo+=fundo; vLu+=luyan; vBea+=beatriz;



                htmlVar += `<tr>

                    <td style="font-weight:bold; color:var(--secondary)">#${v.num||'-'}</td><td>${formatData(v.data)}</td><td>${v.produto} (${v.qtd||1}x)</td><td style="font-weight:bold">${formatMoney(v.valorLiquido)}</td>

                    <td style="color:red">-${formatMoney(ins)}</td><td style="color:red">-${formatMoney(cg)}</td><td style="color:red">-${formatMoney(mo)}</td>

                    <td style="color:green; font-weight:bold">${formatMoney(lucro)}</td>

                    <td>${formatMoney(giro)}</td><td>${formatMoney(fundo)}</td><td>${formatMoney(luyan)}</td><td>${formatMoney(beatriz)}</td>

                </tr>`;

            });

            

            if(db.vendas.length > 0) {

                htmlVar += `<tr style="background: var(--border); font-weight: bold; color: var(--text-main);">

                    <td colspan="3" style="text-align: right;">SOMA VAREJO:</td>

                    <td>${formatMoney(vLiq)}</td><td style="color:red">-${formatMoney(vIns)}</td><td style="color:red">-${formatMoney(vCg)}</td><td style="color:red">-${formatMoney(vMo)}</td>

                    <td style="color:green">${formatMoney(vLucro)}</td><td>${formatMoney(vGiro)}</td><td>${formatMoney(vFundo)}</td><td>${formatMoney(vLu)}</td><td>${formatMoney(vBea)}</td>

                </tr>`;

            }

            document.getElementById('tbody-rateio-varejo').innerHTML = htmlVar;



            let htmlAta = '';

            let aLiq=0, aIns=0, aCg=0, aMo=0, aLucro=0, aGiro=0, aFundo=0, aLu=0, aBea=0;



            db.atacado.sort((a,b)=>new Date(b.data)-new Date(a.data)).forEach(a => {

                if (a.status !== 'PAGO') return; 

                const bruto = a.totalBruto !== undefined ? a.totalBruto : (a.qtd * a.unitario);

                const liq = a.totalLiquido !== undefined ? a.totalLiquido : (a.total !== undefined ? a.total : bruto - (a.desconto||0));

                const insBase = a.qtd * db.config.custoInsumo; const abatCopos = (a.coposDevolvidos || 0) * (db.config.custoCopo || 1.80);

                const ins = Math.max(0, insBase - abatCopos); 

                const base = liq - ins; const cg = base * 0.15; const mo = base * 0.20; const lucro = base - cg - mo;

                const giro = lucro * 0.50, fundo = lucro * 0.15, luyan = lucro * 0.175, beatriz = lucro * 0.175;



                aLiq+=liq; aIns+=ins; aCg+=cg; aMo+=mo; aLucro+=lucro; aGiro+=giro; aFundo+=fundo; aLu+=luyan; aBea+=beatriz;



                htmlAta += `<tr>

                    <td style="font-weight:bold; color:var(--secondary)">#${a.num||'-'}</td><td>${formatData(a.data)}</td><td>${a.cliente} (${a.qtd}x)</td><td style="font-weight:bold">${formatMoney(liq)}</td>

                    <td style="color:red">-${formatMoney(ins)} <br><small style="color:green">${abatCopos>0?'(Eco: '+formatMoney(abatCopos)+')':''}</small></td>

                    <td style="color:red">-${formatMoney(cg)}</td><td style="color:red">-${formatMoney(mo)}</td>

                    <td style="color:green; font-weight:bold">${formatMoney(lucro)}</td>

                    <td>${formatMoney(giro)}</td><td>${formatMoney(fundo)}</td><td>${formatMoney(luyan)}</td><td>${formatMoney(beatriz)}</td>

                </tr>`;

            });



            if(db.atacado.filter(a=>a.status === 'PAGO').length > 0) {

                htmlAta += `<tr style="background: var(--border); font-weight: bold; color: var(--text-main);">

                    <td colspan="3" style="text-align: right;">SOMA ATACADO:</td>

                    <td>${formatMoney(aLiq)}</td><td style="color:red">-${formatMoney(aIns)}</td><td style="color:red">-${formatMoney(aCg)}</td><td style="color:red">-${formatMoney(aMo)}</td>

                    <td style="color:green">${formatMoney(aLucro)}</td><td>${formatMoney(aGiro)}</td><td>${formatMoney(aFundo)}</td><td>${formatMoney(aLu)}</td><td>${formatMoney(aBea)}</td>

                </tr>`;

            }

            document.getElementById('tbody-rateio-atacado').innerHTML = htmlAta;

        }



        function applyAlertClass(elementCollection, val) {

            elementCollection.forEach(el => {

                el.innerText = formatMoney(val);

                if(val < 0) el.classList.add('alerta-negativo');

                else el.classList.remove('alerta-negativo');

            });

        }



        function updateDashboard() {

            let vBruto = 0, vLiquido = 0, vQtd = 0, vEntrega = 0;

            let vInsumo = 0, vCG = 0, vMO = 0, vLucro = 0, vGiro = 0, vFundo = 0, vLuyan = 0, vBeatriz = 0;

            

            db.vendas.forEach(v => {

                vBruto += v.valorBruto; vLiquido += v.valorLiquido; vEntrega += v.entrega || 0;

                const q = (v.produto.includes('Combo') ? 3 : 1) * (v.qtd || 1); vQtd += q;

                const ins = q * db.config.custoInsumo; const base = v.valorLiquido - ins; const cg = base * 0.15; const mo = base * 0.20; const lucro = base - cg - mo;

                vInsumo += ins; vCG += cg; vMO += mo; vLucro += lucro;

                vGiro += lucro * 0.50; vFundo += lucro * 0.15; vLuyan += lucro * 0.175; vBeatriz += lucro * 0.175;

            });



            let aBruto = 0, aDescCopos = 0, aLiquido = 0, aQtd = 0;

            let aInsumo = 0, aCG = 0, aMO = 0, aLucro = 0, aGiro = 0, aFundo = 0, aLuyan = 0, aBeatriz = 0;



            db.atacado.forEach(a => {

                if (a.status !== 'PAGO') return; 

                const bruto = a.totalBruto !== undefined ? a.totalBruto : (a.qtd * a.unitario); const desc = a.desconto || 0; const liq = a.totalLiquido !== undefined ? a.totalLiquido : (a.total !== undefined ? a.total : bruto - desc);

                aBruto += bruto; aDescCopos += desc; aLiquido += liq; aQtd += a.qtd;

                const insBase = a.qtd * db.config.custoInsumo; const abatCopos = (a.coposDevolvidos || 0) * (db.config.custoCopo || 1.80); const ins = Math.max(0, insBase - abatCopos); const base = liq - ins; const cg = base * 0.15; const mo = base * 0.20; const lucro = base - cg - mo;

                aInsumo += ins; aCG += cg; aMO += mo; aLucro += lucro; aGiro += lucro * 0.50; aFundo += lucro * 0.15; aLuyan += lucro * 0.175; aBeatriz += lucro * 0.175;

            });



            let tInsumos = 0, tEmbalagem = 0, tGerais = 0, tMarketing = 0;

            db.despesas.forEach(d => { if(d.categoria === 'INSUMOS') tInsumos += d.total; else if(d.categoria === 'EMBALAGEM') tEmbalagem += d.total; else if(d.categoria === 'GASTOS GERAIS') tGerais += d.total; else if(d.categoria === 'MARKETING') tMarketing += d.total; });



            let saquesGiro = 0, saquesMO = 0, saquesLuyan = 0, saquesBeat = 0;

            db.pagamentos.forEach(p => { if(p.tipo === 'Divida') saquesGiro += p.valor; else if(p.tipo === 'MaoObra') saquesMO += p.valor; else if(p.tipo === 'Luyan') saquesLuyan += p.valor; else if(p.tipo === 'Beatriz') saquesBeat += p.valor; });



            document.getElementById('v-dash-bruto').innerText = formatMoney(vBruto); document.getElementById('v-dash-liquido').innerText = formatMoney(vLiquido); document.getElementById('v-dash-entrega').innerText = formatMoney(vEntrega); document.getElementById('v-dash-qtd').innerText = vQtd; document.getElementById('v-dash-insumos').innerText = formatMoney(vInsumo); document.getElementById('v-dash-cg').innerText = formatMoney(vCG); document.getElementById('v-dash-mo').innerText = formatMoney(vMO); document.getElementById('v-dash-lucro-restante').innerText = formatMoney(vLucro); document.getElementById('v-dash-giro').innerText = formatMoney(vGiro); document.getElementById('v-dash-fundo').innerText = formatMoney(vFundo); document.getElementById('v-dash-luyan').innerText = formatMoney(vLuyan); document.getElementById('v-dash-beatriz').innerText = formatMoney(vBeatriz);

            document.getElementById('a-dash-bruto').innerText = formatMoney(aBruto); document.getElementById('a-dash-desconto').innerText = "- " + formatMoney(aDescCopos); document.getElementById('a-dash-liquido').innerText = formatMoney(aLiquido); document.getElementById('a-dash-qtd').innerText = aQtd; document.getElementById('a-dash-insumos').innerText = formatMoney(aInsumo); document.getElementById('a-dash-cg').innerText = formatMoney(aCG); document.getElementById('a-dash-mo').innerText = formatMoney(aMO); document.getElementById('a-dash-lucro-restante').innerText = formatMoney(aLucro); document.getElementById('a-dash-giro').innerText = formatMoney(aGiro); document.getElementById('a-dash-fundo').innerText = formatMoney(aFundo); document.getElementById('a-dash-luyan').innerText = formatMoney(aLuyan); document.getElementById('a-dash-beatriz').innerText = formatMoney(aBeatriz);



            document.querySelectorAll('.global-faturamento').forEach(el => { el.innerText = formatMoney(vLiquido + aBruto); });

            document.querySelectorAll('.global-pudins').forEach(el => { el.innerText = vQtd + aQtd; });



            let saldoInsumo = (vInsumo + aInsumo) - (tInsumos + tEmbalagem); let saldoCG = (vCG + aCG) - tGerais; let saldoFundo = (vFundo + aFundo) - tMarketing; let saldoMO = (vMO + aMO) - saquesMO; let saldoLuyan = (vLuyan + aLuyan) - saquesLuyan; let saldoBeatriz = (vBeatriz + aBeatriz) - saquesBeat; let saldoGiro = (vGiro + aGiro) - saquesGiro;

            const roi = db.investimentos.reduce((a, c) => a + c.valor, 0) - saquesGiro;



            applyAlertClass(document.querySelectorAll('.global-insumos'), saldoInsumo); applyAlertClass(document.querySelectorAll('.global-cg'), saldoCG); applyAlertClass(document.querySelectorAll('.global-fundo'), saldoFundo); applyAlertClass(document.querySelectorAll('.global-mo'), saldoMO); applyAlertClass(document.querySelectorAll('.global-luyan'), saldoLuyan); applyAlertClass(document.querySelectorAll('.global-beatriz'), saldoBeatriz); applyAlertClass(document.querySelectorAll('.global-giro'), saldoGiro);

            document.querySelectorAll('.global-roi').forEach(el => { el.innerText = roi > 0 ? "Falta " + formatMoney(roi) : "PAGO! Sobra: " + formatMoney(Math.abs(roi)); el.style.color = roi > 0 ? 'var(--danger)' : 'var(--success)'; });



            document.getElementById('dash-desp-insumos').innerText = formatMoney(tInsumos); document.getElementById('dash-desp-embalagem').innerText = formatMoney(tEmbalagem); document.getElementById('dash-desp-gerais').innerText = formatMoney(tGerais); document.getElementById('dash-desp-marketing').innerText = formatMoney(tMarketing);

        }



        init();

    </script>

</body>

</html>
